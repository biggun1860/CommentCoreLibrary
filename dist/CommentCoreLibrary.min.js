/*!Copyright(c) CommentCoreLibrary v0.11.0-rc.1 (//github.com/jabbany/CommentCoreLibrary) - Licensed under the MIT License */
var BinArray=function(){var a={};return a.bsearch=function(a,b,c){if(!Array.isArray(a))throw new Error("Bsearch can only be run on arrays");if(0===a.length)return 0;if(c(b,a[0])<0)return 0;if(c(b,a[a.length-1])>=0)return a.length;for(var d=0,e=0,f=0,g=a.length-1;d<=g;){if(e=Math.floor((g+d+1)/2),f++,c(b,a[e-1])>=0&&c(b,a[e])<0)return e;if(c(b,a[e-1])<0)g=e-1;else{if(!(c(b,a[e])>=0))throw new Error("Program Error. Inconsistent comparator or unsorted array!");d=e}if(f>1500)throw new Error("Iteration depth exceeded. Inconsistent comparator or astronomical dataset!")}return-1},a.binsert=function(b,c,d){var e=a.bsearch(b,c,d);return b.splice(e,0,c),e},a}(),CommentFilter=function(){function a(b,c){for(var d=b.subject.split("."),e=c;d.length>0;){var f=d.shift();if(""!==f&&(e.hasOwnProperty(f)&&(e=e[f]),null===e||void 0===e)){e=null;break}}if(null===e)return!0;switch(b.op){case"<":return e<b.value;case">":return e>b.value;case"~":case"regexp":return new RegExp(b.value).test(e.toString());case"=":case"eq":return b.value===("number"==typeof e?e:e.toString());case"!":case"not":return!a(b.value,e);case"&&":case"and":return!!Array.isArray(b.value)&&b.value.every(function(b){return a(b,e)});case"||":case"or":return!!Array.isArray(b.value)&&b.value.some(function(b){return a(b,e)});default:return!1}}function b(){this.rules=[],this.modifiers=[],this.allowUnknownTypes=!0,this.allowTypes={1:!0,2:!0,4:!0,5:!0,6:!0,7:!0,8:!0,17:!0}}return b.prototype.doModify=function(a){return this.modifiers.reduce(function(a,b){return b(a)},a)},b.prototype.beforeSend=function(a){return a},b.prototype.doValidate=function(b){return!!b.hasOwnProperty("mode")&&(!((!this.allowUnknownTypes||b.mode.toString()in this.allowTypes)&&!this.allowTypes[b.mode.toString()])&&this.rules.every(function(c){try{var d=a(c,b)}catch(a){var d=!1}return"accept"===c.mode?d:!d}))},b.prototype.addRule=function(a){if("accept"!==a.mode&&"reject"!==a.mode)throw new Error("Rule must be of accept type or reject type.");this.rules.push(a)},b.prototype.removeRule=function(a){var b=this.rules.indexOf(a);return b>=0&&(this.rules.splice(b,1),!0)},b.prototype.addModifier=function(a){if("function"!=typeof a)throw new Error("Modifiers need to be functions.");this.modifiers.push(a)},b}(),CommentUtils;!function(a){var b=function(){function a(a){if(this._internalArray=null,!Array.isArray(a))throw new Error("Not an array. Cannot construct matrix.");if(16!=a.length)throw new Error("Illegal Dimensions. Matrix3D should be 4x4 matrix.");this._internalArray=a}return Object.defineProperty(a.prototype,"flatArray",{get:function(){return this._internalArray.slice(0)},set:function(a){throw new Error("Not permitted. Matrices are immutable.")},enumerable:!0,configurable:!0}),a.prototype.isIdentity=function(){return this.equals(a.identity())},a.prototype.dot=function(b){for(var c=this._internalArray.slice(0),d=b._internalArray.slice(0),e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f=0;f<4;f++)for(var g=0;g<4;g++)for(var h=0;h<4;h++)e[4*f+g]+=c[4*f+h]*d[4*h+g];return new a(e)},a.prototype.equals=function(a){for(var b=0;b<16;b++)if(this._internalArray[b]!==a._internalArray[b])return!1;return!0},a.prototype.toCss=function(){for(var a=this._internalArray.slice(0),b=0;b<a.length;b++)Math.abs(a[b])<1e-6&&(a[b]=0);return"matrix3d("+a.join(",")+")"},a.identity=function(){return new a([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},a.createScaleMatrix=function(b,c,d){return new a([b,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1])},a.createRotationMatrix=function(b,c,d){var e=Math.PI/180,f=c*e,g=d*e,h=Math.cos,i=Math.sin;return new a([h(f)*h(g),h(f)*i(g),i(f),0,-i(g),h(g),0,0,-i(f)*h(g),-i(f)*i(g),h(f),0,0,0,0,1].map(function(a){return 1e-10*Math.round(1e10*a)}))},a}();a.Matrix3D=b}(CommentUtils||(CommentUtils={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},CoreComment=function(){function a(b,c){if(void 0===c&&(c={}),this.mode=1,this.stime=0,this.text="",this.ttl=4e3,this.dur=4e3,this.cindex=-1,this.motion=[],this.movable=!0,this.forceShow=!1,this._alphaMotion=null,this.absolute=!0,this.align=0,this.axis=0,this._alpha=1,this._size=25,this._color=16777215,this._border=!1,this._shadow=!0,this._font="",this._transform=null,this._hovering=!1,this._hover=!1,this._hoverTips="",!b)throw new Error("Comment not bound to comment manager.");if(this.parent=b,c.hasOwnProperty("stime")&&(this.stime=c.stime),c.hasOwnProperty("mode")?this.mode=c.mode:this.mode=1,c.hasOwnProperty("dur")&&(this.dur=c.dur,this.ttl=this.dur),this.dur*=this.parent.options.global.scale,this.ttl*=this.parent.options.global.scale,c.hasOwnProperty("text")&&(this.text=c.text),c.hasOwnProperty("motion")){this._motionStart=[],this._motionEnd=[],this.motion=c.motion;for(var d=0,e=0;e<c.motion.length;e++){this._motionStart.push(d);var f=0;for(var g in c.motion[e]){var h=c.motion[e][g];f=Math.max(h.dur+h.delay,f),null!==h.easing&&void 0!==h.easing||(c.motion[e][g].easing=a.LINEAR)}d+=f,this._motionEnd.push(d)}this._curMotion=0}c.hasOwnProperty("color")&&(this._color=c.color),c.hasOwnProperty("size")&&(this._size=c.size),c.hasOwnProperty("border")&&(this._border=c.border),c.hasOwnProperty("opacity")&&(this._alpha=c.opacity),c.hasOwnProperty("alpha")&&(this._alphaMotion=c.alpha),c.hasOwnProperty("font")&&(this._font=c.font),c.hasOwnProperty("x")&&(this._x=c.x),c.hasOwnProperty("y")&&(this._y=c.y),c.hasOwnProperty("shadow")&&(this._shadow=c.shadow),c.hasOwnProperty("align")&&(this.align=c.align),c.hasOwnProperty("axis")&&(this.axis=c.axis),c.hasOwnProperty("transform")&&(this._transform=new CommentUtils.Matrix3D(c.transform)),c.hasOwnProperty("render")&&(this._render=c.render),c.hasOwnProperty("forceShow")&&(this.forceShow=c.forceShow),c.hasOwnProperty("position")&&"relative"===c.position&&(this.absolute=!1,this.mode<7&&console.warn("Using relative position for CSA comment.")),c.hasOwnProperty("hover")&&(this._hover=c.hover),c.hasOwnProperty("hoverTips")&&(this._hoverTips=c.hoverTips)}return a.prototype.init=function(a){var b=this;void 0===a&&(a=null),this._render?this.dom=this._render():(this.dom=null!==a?a.dom:document.createElement("div"),this.dom.className=this.parent.options.global.className,this.dom.appendChild(document.createTextNode(this.text)),this.dom.textContent=this.text,this.dom.innerText=this.text),this.size=this._size,16777215!=this._color&&(this.color=this._color),this.shadow=this._shadow,this._border&&(this.border=this._border),""!==this._font&&(this.font=this._font),void 0!==this._x&&(this.x=this._x),void 0!==this._y&&(this.y=this._y),(1!==this._alpha||this.parent.options.global.opacity<1)&&(this.alpha=this._alpha),null===this._transform||this._transform.isIdentity()||(this.transform=this._transform.flatArray),this.motion.length>0&&this.animate(),this._hover&&(this.dom.style.pointerEvents="auto",this.dom.style.cursor="pointer",this.dom.style.zIndex="1",this.dom.onmouseenter=function(){b._hovering=!0,b.stop(),b._hoverTips&&b.parent.showTips({tips:b._hoverTips,left:b.dom.offsetLeft,top:b.dom.offsetTop+b.dom.offsetHeight})},this.dom.onmouseleave=function(){b._hovering=!1,b.parent.hideTips()})},Object.defineProperty(a.prototype,"x",{get:function(){return null!==this._x&&void 0!==this._x||(this.axis%2==0?this.align%2==0?this._x=this.dom.offsetLeft:this._x=this.dom.offsetLeft+this.width:this.align%2==0?this._x=this.parent.width-this.dom.offsetLeft:this._x=this.parent.width-this.dom.offsetLeft-this.width),this.absolute?this._x:this._x/this.parent.width},set:function(a){this._x=a,this.absolute||(this._x*=this.parent.width),this.axis%2==0?this.dom.style.left=this._x+(this.align%2==0?0:-this.width)+"px":this.dom.style.right=this._x+(this.align%2==0?-this.width:0)+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return null!==this._y&&void 0!==this._y||(this.axis<2?this.align<2?this._y=this.dom.offsetTop:this._y=this.dom.offsetTop+this.height:this.align<2?this._y=this.parent.height-this.dom.offsetTop:this._y=this.parent.height-this.dom.offsetTop-this.height),this.absolute?this._y:this._y/this.parent.height},set:function(a){this._y=a,this.absolute||(this._y*=this.parent.height),this.axis<2?this.dom.style.top=this._y+(this.align<2?0:-this.height)+"px":this.dom.style.bottom=this._y+(this.align<2?-this.height:0)+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottom",{get:function(){var a=Math.floor(this.axis/2)===Math.floor(this.align/2);return this.y+(a?this.height:0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"right",{get:function(){var a=this.axis%2==this.align%2;return this.x+(a?this.width:0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return null!==this._width&&void 0!==this._width||(this._width=this.dom.getBoundingClientRect().width),this._width},set:function(a){this._width=a,this.dom.style.width=this._width+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return null!==this._height&&void 0!==this._height||(this._height=this.dom.offsetHeight),this._height},set:function(a){this._height=a,this.dom.style.height=this._height+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this._size},set:function(a){this._size=a,this.dom.style.fontSize=this._size+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"color",{get:function(){return this._color},set:function(a){this._color=a;var b=a.toString(16);b=b.length>=6?b:new Array(6-b.length+1).join("0")+b,this.dom.style.color="#"+b,0===this._color&&(this.dom.className=this.parent.options.global.className+" rshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"alpha",{get:function(){return this._alpha},set:function(a){this._alpha=a,this.dom.style.opacity=Math.min(this._alpha,this.parent.options.global.opacity)+""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"border",{get:function(){return this._border},set:function(a){this._border=a,this._border?this.dom.style.border="2px solid #ffffff":this.dom.style.border="none"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadow",{get:function(){return this._shadow},set:function(a){this._shadow=a,this._shadow||(this.dom.className=this.parent.options.global.className+" noshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"font",{get:function(){return this._font},set:function(a){this._font=a,this._font.length>0?this.dom.style.fontFamily=this._font:this.dom.style.fontFamily=""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform.flatArray},set:function(a){this._transform=new CommentUtils.Matrix3D(a),null!==this.dom&&(this.dom.style.transform=this._transform.toCss())},enumerable:!0,configurable:!0}),a.prototype.time=function(a){this._hovering||(this.ttl-=a,this.ttl<0&&(this.ttl=0),this.movable&&this.update(),this.ttl<=0&&this.finish())},a.prototype.update=function(){this.animate()},a.prototype.invalidate=function(){this._x=null,this._y=null,this._width=null,this._height=null},a.prototype._execMotion=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];this[c]=d.easing(Math.min(Math.max(b-d.delay,0),d.dur),d.from,d.to-d.from,d.dur)}},a.prototype.animate=function(){if(this._alphaMotion&&(this.alpha=(this.dur-this.ttl)*(this._alphaMotion.to-this._alphaMotion.from)/this.dur+this._alphaMotion.from),0!==this.motion.length){var a=Math.max(this.ttl,0),b=this.dur-a-this._motionStart[this._curMotion];return this._execMotion(this.motion[this._curMotion],b),this.dur-a>this._motionEnd[this._curMotion]?void(++this._curMotion>=this.motion.length&&(this._curMotion=this.motion.length-1)):void 0}},a.prototype.stop=function(){},a.prototype.finish=function(){this.parent.finish(this)},a.prototype.toString=function(){return["[",this.stime,"|",this.ttl,"/",this.dur,"]","(",this.mode,")",this.text].join("")},a.LINEAR=function(a,b,c,d){return a*c/d+b},a}(),ScrollComment=function(a){function b(b,c){a.call(this,b,c),this.dur*=this.parent.options.scroll.scale,this.ttl*=this.parent.options.scroll.scale}return __extends(b,a),Object.defineProperty(b.prototype,"alpha",{set:function(a){this._alpha=a,this.dom.style.opacity=Math.min(Math.min(this._alpha,this.parent.options.global.opacity),this.parent.options.scroll.opacity)+""},enumerable:!0,configurable:!0}),b.prototype.init=function(b){void 0===b&&(b=null),a.prototype.init.call(this,b),this.x=this.parent.width,this.parent.options.scroll.opacity<1&&(this.alpha=this._alpha),this.absolute=!0},b.prototype.update=function(){this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width},b}(CoreComment),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},CssCompatLayer=function(){function a(){}return a.transform=function(a,b){a.style.transform=b,a.style.webkitTransform=b,a.style.msTransform=b,a.style.oTransform=b},a}(),CssScrollComment=function(a){function b(){a.apply(this,arguments),this._dirtyCSS=!0}return __extends(b,a),Object.defineProperty(b.prototype,"x",{get:function(){return this.ttl/this.dur*(this.parent.width+this.width)-this.width},set:function(a){if(null!==this._x&&"number"==typeof this._x){var b=a-this._x;this._x=a,CssCompatLayer.transform(this.dom,"translateX("+(this.axis%2==0?b:-b)+"px)")}else this._x=a,this.absolute||(this._x*=this.parent.width),this.axis%2==0?this.dom.style.left=this._x+(this.align%2==0?0:-this.width)+"px":this.dom.style.right=this._x+(this.align%2==0?-this.width:0)+"px"},enumerable:!0,configurable:!0}),b.prototype.update=function(){this._dirtyCSS&&(this.dom.style.transition="transform "+this.ttl+"ms linear",this.x=-this.width,this._dirtyCSS=!1)},b.prototype.invalidate=function(){a.prototype.invalidate.call(this),this._dirtyCSS=!0},b.prototype.stop=function(){a.prototype.stop.call(this),this.dom.style.transition="",this.x=this._x,this._x=null,this.x=this.x,this._dirtyCSS=!0},b}(ScrollComment),CommentFactory=function(){function a(){this._bindings={}}return a._simpleCssScrollingInitializer=function(a,b){var c=new CssScrollComment(a,b);switch(c.mode){case 1:c.align=0,c.axis=0;break;case 2:c.align=2,c.axis=2;break;case 6:c.align=1,c.axis=1}return c.init(),a.stage.appendChild(c.dom),c},a._simpleScrollingInitializer=function(a,b){var c=new ScrollComment(a,b);switch(c.mode){case 1:c.align=0,c.axis=0;break;case 2:c.align=2,c.axis=2;break;case 6:c.align=1,c.axis=1}return c.init(),a.stage.appendChild(c.dom),c},a._simpleAnchoredInitializer=function(a,b){var c=new CoreComment(a,b);switch(c.mode){case 4:c.align=2,c.axis=2;break;case 5:c.align=0,c.axis=0}return c.init(),a.stage.appendChild(c.dom),c},a._advancedCoreInitializer=function(a,b){var c=new CoreComment(a,b);return c.init(),c.transform=CommentUtils.Matrix3D.createRotationMatrix(0,b.rY,b.rZ).flatArray,a.stage.appendChild(c.dom),c},a.defaultFactory=function(){var b=new a;return b.bind(1,a._simpleScrollingInitializer),b.bind(2,a._simpleScrollingInitializer),b.bind(6,a._simpleScrollingInitializer),b.bind(4,a._simpleAnchoredInitializer),b.bind(5,a._simpleAnchoredInitializer),b.bind(7,a._advancedCoreInitializer),b.bind(17,a._advancedCoreInitializer),b},a.defaultCssRenderFactory=function(){var b=new a;return b.bind(1,a._simpleCssScrollingInitializer),b.bind(2,a._simpleCssScrollingInitializer),b.bind(6,a._simpleCssScrollingInitializer),b.bind(4,a._simpleAnchoredInitializer),b.bind(5,a._simpleAnchoredInitializer),b.bind(7,a._advancedCoreInitializer),b.bind(17,a._advancedCoreInitializer),b},a.defaultCanvasRenderFactory=function(){throw new Error("Not implemented")},a.defaultSvgRenderFactory=function(){throw new Error("Not implemented")},a.prototype.bind=function(a,b){this._bindings[a]=b},a.prototype.canCreate=function(a){return this._bindings.hasOwnProperty(a.mode)},a.prototype.create=function(a,b){if(null===b||!b.hasOwnProperty("mode"))throw new Error("Comment format incorrect");if(!this._bindings.hasOwnProperty(b.mode))throw new Error("No binding for comment type "+b.mode);return this._bindings[b.mode](a,b)},a}(),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},CommentSpaceAllocator=function(){function a(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this._pools=[[]],this.avoid=1,this._width=a,this._height=b}return a.prototype.willCollide=function(a,b){var c=b.dur*b.width/(this._width+b.width);return a.stime+a.ttl+c>=b.stime+b.ttl},a.prototype.pathCheck=function(a,b,c){for(var d=a+b.height,e=b.right,f=0;f<c.length;f++)if(!(c[f].y>d||c[f].bottom<a)){if(!(c[f].right<b.x||c[f].x>e))return!1;if(this.willCollide(c[f],b))return!1}return!0},a.prototype.assign=function(a,b){for(;this._pools.length<=b;)this._pools.push([]);var c=this._pools[b];if(0===c.length)return a.cindex=b,0;if(this.pathCheck(0,a,c))return a.cindex=b,0;for(var d=0,e=0;e<c.length&&!((d=c[e].bottom+this.avoid)+a.height>this._height);e++)if(this.pathCheck(d,a,c))return a.cindex=b,d;return this.assign(a,b+1)},a.prototype.add=function(a){a.height>this._height?(a.cindex=-2,a.y=0):(a.y=this.assign(a,0),BinArray.binsert(this._pools[a.cindex],a,function(a,b){return a.bottom<b.bottom?-1:a.bottom>b.bottom?1:0}))},a.prototype.remove=function(a){if(!(a.cindex<0)){if(a.cindex>=this._pools.length)throw new Error("cindex out of bounds");var b=this._pools[a.cindex].indexOf(a);b<0||this._pools[a.cindex].splice(b,1)}},a.prototype.setBounds=function(a,b){this._width=a,this._height=b},a}(),AnchorCommentSpaceAllocator=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.add=function(b){a.prototype.add.call(this,b),b.x=(this._width-b.width)/2},b.prototype.willCollide=function(a,b){return!0},b.prototype.pathCheck=function(a,b,c){for(var d=a+b.height,e=0;e<c.length;e++)if(!(c[e].y>d||c[e].bottom<a))return!1;return!0},b}(CommentSpaceAllocator);window.CommentManager=function(){function a(a){var b=0;this._listeners={},this._lastPosition=0,this.stage=a,this.options={global:{opacity:1,scale:1,className:"cmt"},scroll:{opacity:1,scale:1},limit:0,seekTrigger:2e3},this.timeline=[],this.runline=[],this.position=0,this.domTips=document.createElement("div"),this.domTips.className="cmt-tips",this.stage.appendChild(this.domTips),this.factory=null,this.filter=null,this.csa={scroll:new CommentSpaceAllocator(0,0),top:new AnchorCommentSpaceAllocator(0,0),bottom:new AnchorCommentSpaceAllocator(0,0),reverse:new CommentSpaceAllocator(0,0),scrollbtm:new CommentSpaceAllocator(0,0)},this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight,this._startTimer=function(){if(!(b>0)){var a=(new Date).getTime(),c=this;b=window.setInterval(function(){var b=(new Date).getTime()-a;a=(new Date).getTime(),c.onTimerEvent(b,c)},10)}},this._stopTimer=function(){window.clearInterval(b),b=0}}var b=function(a,b){return a.stime>b.stime?2:a.stime<b.stime?-2:a.date>b.date?1:a.date<b.date?-1:null!=a.dbid&&null!=b.dbid?a.dbid>b.dbid?1:a.dbid<b.dbid?-1:0:0};return a.prototype.stop=function(){this._stopTimer(),this.runline.forEach(function(a){a.stop()})},a.prototype.start=function(){this._startTimer()},a.prototype.hasaki=function(a){this._hasaki=a,this._hasaki.ttl=a.duration},a.prototype.seek=function(a){this.position=BinArray.bsearch(this.timeline,a,function(a,b){return a<b.stime?-1:a>b.stime?1:0})},a.prototype.validate=function(a){return null!=a&&this.filter.doValidate(a)},a.prototype.load=function(a){this.timeline=a,this.timeline.sort(b),this.dispatchEvent("load")},a.prototype.insert=function(a){BinArray.binsert(this.timeline,a,b)<=this.position&&this.position++,this.dispatchEvent("insert")},a.prototype.clear=function(){for(;this.runline.length>0;)this.runline[0].finish();this.dispatchEvent("clear")},a.prototype.setBounds=function(a,b){this.width=a||this.stage.offsetWidth,this.height=b||this.stage.offsetHeight,this.dispatchEvent("resize");for(var c in this.csa)this.csa[c].setBounds(this.width,this.height);this.stage.style.perspective=this.width/Math.tan(55*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width/Math.tan(55*Math.PI/180)/2+"px"},a.prototype.init=function(a){if(this.setBounds(),null==this.filter&&(this.filter=new CommentFilter),null==this.factory)switch(a){case"legacy":this.factory=CommentFactory.defaultFactory();break;default:case"css":this.factory=CommentFactory.defaultCssRenderFactory()}},a.prototype.time=function(a){if(a-=1,this.position>=this.timeline.length||Math.abs(this._lastPosition-a)>=this.options.seekTrigger){if(this.seek(a),this._lastPosition=a,this.timeline.length<=this.position)return}else this._lastPosition=a;for(;this.position<this.timeline.length&&this.timeline[this.position].stime<=a;this.position++)this.options.limit>0&&this.runline.length>=this.options.limit||this.validate(this.timeline[this.position])&&this.send(this.timeline[this.position])},a.prototype.rescale=function(){},a.prototype.send=function(a){if(8===a.mode)return console.log(a),void(this.scripting&&console.log(this.scripting.eval(a.code)));if(null==this.filter||null!=(a=this.filter.doModify(a))){var b=this.factory.create(this,a);switch(b.mode){default:case 1:this.csa.scroll.add(b);break;case 2:this.csa.scrollbtm.add(b);break;case 4:this.csa.bottom.add(b);break;case 5:this.csa.top.add(b);break;case 6:this.csa.reverse.add(b);break;case 7:case 17:}b.y=b.y,this.dispatchEvent("enterComment",b),this.runline.push(b),b.cindex>0&&!b.forceShow&&b.finish()}},a.prototype.finish=function(a){this.dispatchEvent("exitComment",a),this.stage.removeChild(a.dom);var b=this.runline.indexOf(a);switch(b>=0&&this.runline.splice(b,1),a.mode){default:case 1:this.csa.scroll.remove(a);break;case 2:this.csa.scrollbtm.remove(a);break;case 4:this.csa.bottom.remove(a);break;case 5:this.csa.top.remove(a);break;case 6:this.csa.reverse.remove(a);break;case 7:}},a.prototype.addEventListener=function(a,b){void 0!==this._listeners[a]?this._listeners[a].push(b):this._listeners[a]=[b]},a.prototype.dispatchEvent=function(a,b){if(void 0!==this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)try{this._listeners[a][c](b)}catch(a){console.err(a.stack)}},a.prototype.onTimerEvent=function(a,b){if(this._hasaki){this._hasaki.ttl-=a;var c=(this._hasaki.duration-this._hasaki.ttl)/this._hasaki.duration;this._hasaki.maxTtlPercent=this._hasaki.ttlPercent+(1-this._hasaki.ttlPercent)*c,this._hasaki.ttl<=0&&(this._hasaki=null)}for(var d=0;d<b.runline.length;d++){var e=b.runline[d];e.time(a);var f=e.ttl/e.dur;this._hasaki&&e.y>=this._hasaki.minTop&&e.y<=this._hasaki.maxTop&&f>=this._hasaki.ttlPercent&&f<=this._hasaki.maxTtlPercent&&e.finish()}},a.prototype.showTips=function(a){this.domTips.innerHTML=a.tips,this.domTips.style.left=a.left+"px",this.domTips.style.top=a.top+"px",this.domTips.style.display="block"},a.prototype.hideTips=function(){this.domTips.style.display="none"},a}();